<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamefolio</title>
    <link rel="icon" type="image/x-icon" href="../public/assets/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel = "stylesheet" href = "styles/style.css"> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
    
    <script>

    document.addEventListener('DOMContentLoaded', () => {
        const removeButtons = document.querySelectorAll('.removeBtn');

        removeButtons.forEach(button => {
            button.addEventListener('click', async (event) => {
            const buttonId = parseInt(button.getAttribute('data-id')); // Parse as integer
            console.log('Button ID:', buttonId);
            const listItem = button.closest('li'); // Find the closest <li> parent element
            listItem.remove(); // Remove the list entry from the DOM

            try {
                const response = await axios.post('/deleteItem', { id: buttonId });
                console.log(response.data.message);
            } catch (error) {
                console.error('Error:', error);
            }
            });
        });

        // function to download image of list
         /*document.getElementById('dl-png').addEventListener('click', () => {

            function filter (node) {
                return (node.className !== 'removeBtn');
            };

            htmlToImage.toPng(document.getElementById('dl-target'), { quality: 1, filter: filter})
            .then(function (dataUrl) {
                var link = document.createElement('a');
                link.download = 'my-gamesList.png';
                link.href = dataUrl;
                link.click();
            });
        });*/
    }); 


    </script>
</head>


<body>
    <h2 class = "title">
        <span class = "title click" onclick = "window.location.href = 'https://ethanl818.github.io/personal-portfolio/'">ðŸ‘¾Gamefolio<span class = "subtitle">game-portfolio</span></span>
    </h2>

    <!--Create a form-->
    <div class = "container">
        <form action="/" method="POST"> 
            <div class = "row">
                <input type="text" name="new-game" placeholder="Enter a game (EXACT NAME):" class = "text-box">
                <button class = "button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                </button>
            </div>
        </form>


        <div id  = "dl-target">

        <% if (locals.content) {%>
        
            <ul id = "gamesList">
                <% for (var i = 0; i < content.length; i++) { %>
                    <li>
                        <img class="cover" src = <%= (content[i].cover.url).replace("thumb", "cover_big") %>>

                        <div>
                            <h3 class="gameName">
                                
                                <% var ratingClass = "";
                                var ratingValue = Math.floor(content[i].rating);
                             
                                if (ratingValue <= 70 && ratingValue >= 50) {
                                    ratingClass = "yellow";
                                } else if (ratingValue < 50) {
                                    ratingClass = "red";
                                } %>
                             
                             <span class="gameRating <%= ratingClass %>">
                                 <%= ratingValue %>
                             </span>
                             
                                <%= content[i].name %>
                            </h3>

                            <p><%= content[i].summary %></p>

                            <% for (var j = 0; j < content[i].genres.length; j++) { %>
                                <button type="button" class="tagBtn"><%= content[i].genres[j].name %></button>
                            <% } %>

                            <% const date = new Date(content[i].release_dates[0].date * 1000); // Convert Unix timestamp to milliseconds
                            const month = String(date.getMonth() + 1).padStart(2, '0');
                            const day = String(date.getDate()).padStart(2, '0');
                            const year = String(date.getFullYear()); %>

                            <button type="button" class="tagBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-event" viewBox="0 0 16 16">
                                    <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/>
                                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                </svg>
                                <%= `${month}/${day}/${year}` %>
                            </button>
                        </div>

                        <form action="/deleteItem" method="POST" id="<%= i %>">
                            <button type="button" class="removeBtn" data-id="<%= i.toString().trim() %>">Remove</button>
                        </form>
                    </li>
                <% } %>
            </ul>
        </div>
        <% } %>  
    </div>

</body>
</html>